"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.setupUpLinks = setupUpLinks;
exports.updateVersionsHiddenUpLink = updateVersionsHiddenUpLink;

var _upStorage = _interopRequireDefault(require("./up-storage"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Set up the Up Storage for each link.
 */
function setupUpLinks(config) {
  const uplinks = {};

  for (const uplinkName in config.uplinks) {
    if (Object.prototype.hasOwnProperty.call(config.uplinks, uplinkName)) {
      // instance for each up-link definition
      const proxy = new _upStorage.default(config.uplinks[uplinkName], config);
      proxy.upname = uplinkName;
      uplinks[uplinkName] = proxy;
    }
  }

  return uplinks;
}

function updateVersionsHiddenUpLink(versions, upLink) {
  for (const i in versions) {
    if (Object.prototype.hasOwnProperty.call(versions, i)) {
      const version = versions[i]; // holds a "hidden" value to be used by the package storage.
      // $FlowFixMe

      version[Symbol.for('__verdaccio_uplink')] = upLink.upname;
    }
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvdXBsaW5rLXV0aWwudHMiXSwibmFtZXMiOlsic2V0dXBVcExpbmtzIiwiY29uZmlnIiwidXBsaW5rcyIsInVwbGlua05hbWUiLCJPYmplY3QiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJwcm94eSIsIlByb3h5U3RvcmFnZSIsInVwbmFtZSIsInVwZGF0ZVZlcnNpb25zSGlkZGVuVXBMaW5rIiwidmVyc2lvbnMiLCJ1cExpbmsiLCJpIiwidmVyc2lvbiIsIlN5bWJvbCIsImZvciJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTs7OztBQUlBOzs7QUFHTyxTQUFTQSxZQUFULENBQXNCQyxNQUF0QixFQUFpRDtBQUN0RCxRQUFNQyxPQUFrQixHQUFHLEVBQTNCOztBQUVBLE9BQUssTUFBTUMsVUFBWCxJQUF5QkYsTUFBTSxDQUFDQyxPQUFoQyxFQUF5QztBQUN2QyxRQUFJRSxNQUFNLENBQUNDLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ04sTUFBTSxDQUFDQyxPQUE1QyxFQUFxREMsVUFBckQsQ0FBSixFQUFzRTtBQUNwRTtBQUNBLFlBQU1LLEtBQWEsR0FBRyxJQUFJQyxrQkFBSixDQUFpQlIsTUFBTSxDQUFDQyxPQUFQLENBQWVDLFVBQWYsQ0FBakIsRUFBNkNGLE1BQTdDLENBQXRCO0FBQ0FPLE1BQUFBLEtBQUssQ0FBQ0UsTUFBTixHQUFlUCxVQUFmO0FBRUFELE1BQUFBLE9BQU8sQ0FBQ0MsVUFBRCxDQUFQLEdBQXNCSyxLQUF0QjtBQUNEO0FBQ0Y7O0FBRUQsU0FBT04sT0FBUDtBQUNEOztBQUVNLFNBQVNTLDBCQUFULENBQW9DQyxRQUFwQyxFQUF3REMsTUFBeEQsRUFBOEU7QUFDbkYsT0FBSyxNQUFNQyxDQUFYLElBQWdCRixRQUFoQixFQUEwQjtBQUN4QixRQUFJUixNQUFNLENBQUNDLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ0ssUUFBckMsRUFBK0NFLENBQS9DLENBQUosRUFBdUQ7QUFDckQsWUFBTUMsT0FBTyxHQUFHSCxRQUFRLENBQUNFLENBQUQsQ0FBeEIsQ0FEcUQsQ0FHckQ7QUFDQTs7QUFDQUMsTUFBQUEsT0FBTyxDQUFDQyxNQUFNLENBQUNDLEdBQVAsQ0FBVyxvQkFBWCxDQUFELENBQVAsR0FBNENKLE1BQU0sQ0FBQ0gsTUFBbkQ7QUFDRDtBQUNGO0FBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUHJveHlTdG9yYWdlIGZyb20gJy4vdXAtc3RvcmFnZSc7XG5pbXBvcnQgeyBWZXJzaW9ucywgQ29uZmlnIH0gZnJvbSAnQHZlcmRhY2Npby90eXBlcyc7XG5pbXBvcnQgeyBJUHJveHksIFByb3h5TGlzdCB9IGZyb20gJy4uLy4uL3R5cGVzJztcblxuLyoqXG4gKiBTZXQgdXAgdGhlIFVwIFN0b3JhZ2UgZm9yIGVhY2ggbGluay5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldHVwVXBMaW5rcyhjb25maWc6IENvbmZpZyk6IFByb3h5TGlzdCB7XG4gIGNvbnN0IHVwbGlua3M6IFByb3h5TGlzdCA9IHt9O1xuXG4gIGZvciAoY29uc3QgdXBsaW5rTmFtZSBpbiBjb25maWcudXBsaW5rcykge1xuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoY29uZmlnLnVwbGlua3MsIHVwbGlua05hbWUpKSB7XG4gICAgICAvLyBpbnN0YW5jZSBmb3IgZWFjaCB1cC1saW5rIGRlZmluaXRpb25cbiAgICAgIGNvbnN0IHByb3h5OiBJUHJveHkgPSBuZXcgUHJveHlTdG9yYWdlKGNvbmZpZy51cGxpbmtzW3VwbGlua05hbWVdLCBjb25maWcpO1xuICAgICAgcHJveHkudXBuYW1lID0gdXBsaW5rTmFtZTtcblxuICAgICAgdXBsaW5rc1t1cGxpbmtOYW1lXSA9IHByb3h5O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB1cGxpbmtzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdXBkYXRlVmVyc2lvbnNIaWRkZW5VcExpbmsodmVyc2lvbnM6IFZlcnNpb25zLCB1cExpbms6IElQcm94eSk6IHZvaWQge1xuICBmb3IgKGNvbnN0IGkgaW4gdmVyc2lvbnMpIHtcbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHZlcnNpb25zLCBpKSkge1xuICAgICAgY29uc3QgdmVyc2lvbiA9IHZlcnNpb25zW2ldO1xuXG4gICAgICAvLyBob2xkcyBhIFwiaGlkZGVuXCIgdmFsdWUgdG8gYmUgdXNlZCBieSB0aGUgcGFja2FnZSBzdG9yYWdlLlxuICAgICAgLy8gJEZsb3dGaXhNZVxuICAgICAgdmVyc2lvbltTeW1ib2wuZm9yKCdfX3ZlcmRhY2Npb191cGxpbmsnKV0gPSB1cExpbmsudXBuYW1lO1xuICAgIH1cbiAgfVxufVxuIl19