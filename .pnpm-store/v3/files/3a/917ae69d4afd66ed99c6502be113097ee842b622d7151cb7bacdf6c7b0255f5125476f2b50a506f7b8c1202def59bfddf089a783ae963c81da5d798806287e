"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _lodash = _interopRequireDefault(require("lodash"));

var _cookies = _interopRequireDefault(require("cookies"));

var _utils = require("../../../lib/utils");

var _constants = require("../../../lib/constants");

var _authUtils = require("../../../lib/auth-utils");

var _logger = require("../../../lib/logger");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _default(route, auth, config) {
  route.get('/-/user/:org_couchdb_user', function (req, res, next) {
    res.status(_constants.HTTP_STATUS.OK);
    next({
      ok: (0, _authUtils.getAuthenticatedMessage)(req.remote_user.name)
    });
  });
  route.put('/-/user/:org_couchdb_user/:_rev?/:revision?', function (req, res, next) {
    const {
      name,
      password
    } = req.body;
    const remoteName = req.remote_user.name;

    if (_lodash.default.isNil(remoteName) === false && _lodash.default.isNil(name) === false && remoteName === name) {
      auth.authenticate(name, password, async function callbackAuthenticate(err, user) {
        if (err) {
          _logger.logger.trace({
            name,
            err
          }, 'authenticating for user @{username} failed. Error: @{err.message}');

          return next(_utils.ErrorCode.getCode(_constants.HTTP_STATUS.UNAUTHORIZED, _constants.API_ERROR.BAD_USERNAME_PASSWORD));
        }

        const restoredRemoteUser = (0, _authUtils.createRemoteUser)(name, user.groups || []);
        const token = await (0, _authUtils.getApiToken)(auth, config, restoredRemoteUser, password);
        res.status(_constants.HTTP_STATUS.CREATED);
        return next({
          ok: (0, _authUtils.getAuthenticatedMessage)(req.remote_user.name),
          token
        });
      });
    } else {
      if ((0, _authUtils.validatePassword)(password) === false) {
        // eslint-disable-next-line new-cap
        return next(_utils.ErrorCode.getCode(_constants.HTTP_STATUS.BAD_REQUEST, _constants.API_ERROR.PASSWORD_SHORT()));
      }

      auth.add_user(name, password, async function (err, user) {
        if (err) {
          if (err.status >= _constants.HTTP_STATUS.BAD_REQUEST && err.status < _constants.HTTP_STATUS.INTERNAL_ERROR) {
            // With npm registering is the same as logging in,
            // and npm accepts only an 409 error.
            // So, changing status code here.
            return next(_utils.ErrorCode.getCode(err.status, err.message) || _utils.ErrorCode.getConflict(err.message));
          }

          return next(err);
        }

        const token = name && password ? await (0, _authUtils.getApiToken)(auth, config, user, password) : undefined;
        req.remote_user = user;
        res.status(_constants.HTTP_STATUS.CREATED);
        return next({
          ok: `user '${req.body.name}' created`,
          token
        });
      });
    }
  });
  route.delete('/-/user/token/*', function (req, res, next) {
    res.status(_constants.HTTP_STATUS.OK);
    next({
      ok: _constants.API_MESSAGE.LOGGED_OUT
    });
  }); // placeholder 'cause npm require to be authenticated to publish
  // we do not do any real authentication yet

  route.post('/_session', _cookies.default.express(), function (req, res, next) {
    res.cookies.set('AuthSession', String(Math.random()), (0, _authUtils.createSessionToken)());
    next({
      ok: true,
      name: 'somebody',
      roles: []
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcGkvZW5kcG9pbnQvYXBpL3VzZXIudHMiXSwibmFtZXMiOlsicm91dGUiLCJhdXRoIiwiY29uZmlnIiwiZ2V0IiwicmVxIiwicmVzIiwibmV4dCIsInN0YXR1cyIsIkhUVFBfU1RBVFVTIiwiT0siLCJvayIsInJlbW90ZV91c2VyIiwibmFtZSIsInB1dCIsInBhc3N3b3JkIiwiYm9keSIsInJlbW90ZU5hbWUiLCJfIiwiaXNOaWwiLCJhdXRoZW50aWNhdGUiLCJjYWxsYmFja0F1dGhlbnRpY2F0ZSIsImVyciIsInVzZXIiLCJsb2dnZXIiLCJ0cmFjZSIsIkVycm9yQ29kZSIsImdldENvZGUiLCJVTkFVVEhPUklaRUQiLCJBUElfRVJST1IiLCJCQURfVVNFUk5BTUVfUEFTU1dPUkQiLCJyZXN0b3JlZFJlbW90ZVVzZXIiLCJncm91cHMiLCJ0b2tlbiIsIkNSRUFURUQiLCJCQURfUkVRVUVTVCIsIlBBU1NXT1JEX1NIT1JUIiwiYWRkX3VzZXIiLCJJTlRFUk5BTF9FUlJPUiIsIm1lc3NhZ2UiLCJnZXRDb25mbGljdCIsInVuZGVmaW5lZCIsImRlbGV0ZSIsIkFQSV9NRVNTQUdFIiwiTE9HR0VEX09VVCIsInBvc3QiLCJDb29raWVzIiwiZXhwcmVzcyIsImNvb2tpZXMiLCJzZXQiLCJTdHJpbmciLCJNYXRoIiwicmFuZG9tIiwicm9sZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQU1lLGtCQUFTQSxLQUFULEVBQXdCQyxJQUF4QixFQUFxQ0MsTUFBckMsRUFBMkQ7QUFDeEVGLEVBQUFBLEtBQUssQ0FBQ0csR0FBTixDQUFVLDJCQUFWLEVBQXVDLFVBQVNDLEdBQVQsRUFBOEJDLEdBQTlCLEVBQTZDQyxJQUE3QyxFQUEyRTtBQUNoSEQsSUFBQUEsR0FBRyxDQUFDRSxNQUFKLENBQVdDLHVCQUFZQyxFQUF2QjtBQUNBSCxJQUFBQSxJQUFJLENBQUM7QUFDSEksTUFB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QUFDRSxNQUFKLENBQVdDLHVCQUFZeUIsT0FBdkI7QUFDQSxlQUFPM0IsSUFBSSxDQUFDO0FBQ1ZJLFVBQUFBLEVBQUUsRUFBRyxTQUFRTixHQUFHLENBQUNXLElBQUosQ0FBU0gsSUFBSyxXQURqQjtBQUVWb0IsVUFBQUE7QUFGVSxTQUFELENBQVg7QUFJRCxPQW5CRDtBQW9CRDtBQUNGLEdBaEREO0FBa0RBaEMsRUFBQUEsS0FBSyxDQUFDeUMsTUFBTixDQUFhLGlCQUFiLEVBQWdDLFVBQVNyQyxHQUFULEVBQThCQyxHQUE5QixFQUE2Q0MsSUFBN0MsRUFBMkU7QUFDekdELElBQUFBLEdBQUcsQ0FBQ0UsTUFBSixDQUFXQyx1QkFBWUMsRUFBdkI7QUFDQUgsSUFBQUEsSUFBSSxDQUFDO0FBQ0hJLE1BQUFBLEVBQUUsRUFBRWdDLHVCQUFZQztBQURiLEtBQUQsQ0FBSjtBQUdELEdBTEQsRUExRHdFLENBaUV4RTtBQUNBOztBQUNBM0MsRUFBQUEsS0FBSyxDQUFDNEMsSUFBTixDQUFXLFdBQVgsRUFBd0JDLGlCQUFRQyxPQUFSLEVBQXhCLEVBQTJDLFVBQVMxQyxHQUFULEVBQThCQyxHQUE5QixFQUFvREMsSUFBcEQsRUFBa0Y7QUFDM0hELElBQUFBLEdBQUcsQ0FBQzBDLE9BQUosQ0FBWUMsR0FBWixDQUFnQixhQUFoQixFQUErQkMsTUFBTSxDQUFDQyxJQUFJLENBQUNDLE1BQUwsRUFBRCxDQUFyQyxFQUFzRCxvQ0FBdEQ7QUFFQTdDLElBQUFBLElBQUksQ0FBQztBQUNISSxNQUFBQSxFQUFFLEVBQUUsSUFERDtBQUVIRSxNQUFBQSxJQUFJLEVBQUUsVUFGSDtBQUdId0MsTUFBQUEsS0FBSyxFQUFFO0FBSEosS0FBRCxDQUFKO0FBS0QsR0FSRDtBQVNEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBDb29raWVzIGZyb20gJ2Nvb2tpZXMnO1xuXG5pbXBvcnQgeyBFcnJvckNvZGUgfSBmcm9tICcuLi8uLi8uLi9saWIvdXRpbHMnO1xuaW1wb3J0IHsgQVBJX0VSUk9SLCBBUElfTUVTU0FHRSwgSFRUUF9TVEFUVVMgfSBmcm9tICcuLi8uLi8uLi9saWIvY29uc3RhbnRzJztcbmltcG9ydCB7IGNyZWF0ZVJlbW90ZVVzZXIsIGNyZWF0ZVNlc3Npb25Ub2tlbiwgZ2V0QXBpVG9rZW4sIGdldEF1dGhlbnRpY2F0ZWRNZXNzYWdlLCB2YWxpZGF0ZVBhc3N3b3JkIH0gZnJvbSAnLi4vLi4vLi4vbGliL2F1dGgtdXRpbHMnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vLi4vLi4vbGliL2xvZ2dlcic7XG5cbmltcG9ydCB7IENvbmZpZywgUmVtb3RlVXNlciB9IGZyb20gJ0B2ZXJkYWNjaW8vdHlwZXMnO1xuaW1wb3J0IHsgUmVzcG9uc2UsIFJvdXRlciB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgJFJlcXVlc3RFeHRlbmQsICRSZXNwb25zZUV4dGVuZCwgJE5leHRGdW5jdGlvblZlciwgSUF1dGggfSBmcm9tICcuLi8uLi8uLi8uLi90eXBlcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uKHJvdXRlOiBSb3V0ZXIsIGF1dGg6IElBdXRoLCBjb25maWc6IENvbmZpZyk6IHZvaWQge1xuICByb3V0ZS5nZXQoJy8tL3VzZXIvOm9yZ19jb3VjaGRiX3VzZXInLCBmdW5jdGlvbihyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6IFJlc3BvbnNlLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5PSyk7XG4gICAgbmV4dCh7XG4gICAgICBvazogZ2V0QXV0aGVudGljYXRlZE1lc3NhZ2UocmVxLnJlbW90ZV91c2VyLm5hbWUpLFxuICAgIH0pO1xuICB9KTtcblxuICByb3V0ZS5wdXQoJy8tL3VzZXIvOm9yZ19jb3VjaGRiX3VzZXIvOl9yZXY/LzpyZXZpc2lvbj8nLCBmdW5jdGlvbihyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6IFJlc3BvbnNlLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgY29uc3QgeyBuYW1lLCBwYXNzd29yZCB9ID0gcmVxLmJvZHk7XG4gICAgY29uc3QgcmVtb3RlTmFtZSA9IHJlcS5yZW1vdGVfdXNlci5uYW1lO1xuXG4gICAgaWYgKF8uaXNOaWwocmVtb3RlTmFtZSkgPT09IGZhbHNlICYmIF8uaXNOaWwobmFtZSkgPT09IGZhbHNlICYmIHJlbW90ZU5hbWUgPT09IG5hbWUpIHtcbiAgICAgIGF1dGguYXV0aGVudGljYXRlKG5hbWUsIHBhc3N3b3JkLCBhc3luYyBmdW5jdGlvbiBjYWxsYmFja0F1dGhlbnRpY2F0ZShlcnIsIHVzZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIGxvZ2dlci50cmFjZSh7IG5hbWUsIGVyciB9LCAnYXV0aGVudGljYXRpbmcgZm9yIHVzZXIgQHt1c2VybmFtZX0gZmFpbGVkLiBFcnJvcjogQHtlcnIubWVzc2FnZX0nKTtcbiAgICAgICAgICByZXR1cm4gbmV4dChFcnJvckNvZGUuZ2V0Q29kZShIVFRQX1NUQVRVUy5VTkFVVEhPUklaRUQsIEFQSV9FUlJPUi5CQURfVVNFUk5BTUVfUEFTU1dPUkQpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHJlc3RvcmVkUmVtb3RlVXNlcjogUmVtb3RlVXNlciA9IGNyZWF0ZVJlbW90ZVVzZXIobmFtZSwgdXNlci5ncm91cHMgfHwgW10pO1xuICAgICAgICBjb25zdCB0b2tlbiA9IGF3YWl0IGdldEFwaVRva2VuKGF1dGgsIGNvbmZpZywgcmVzdG9yZWRSZW1vdGVVc2VyLCBwYXNzd29yZCk7XG5cbiAgICAgICAgcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5DUkVBVEVEKTtcblxuICAgICAgICByZXR1cm4gbmV4dCh7XG4gICAgICAgICAgb2s6IGdldEF1dGhlbnRpY2F0ZWRNZXNzYWdlKHJlcS5yZW1vdGVfdXNlci5uYW1lKSxcbiAgICAgICAgICB0b2tlbixcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHZhbGlkYXRlUGFzc3dvcmQocGFzc3dvcmQpID09PSBmYWxzZSkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbmV3LWNhcFxuICAgICAgICByZXR1cm4gbmV4dChFcnJvckNvZGUuZ2V0Q29kZShIVFRQX1NUQVRVUy5CQURfUkVRVUVTVCwgQVBJX0VSUk9SLlBBU1NXT1JEX1NIT1JUKCkpKTtcbiAgICAgIH1cblxuICAgICAgYXV0aC5hZGRfdXNlcihuYW1lLCBwYXNzd29yZCwgYXN5bmMgZnVuY3Rpb24oZXJyLCB1c2VyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICBpZiAoZXJyLnN0YXR1cyA+PSBIVFRQX1NUQVRVUy5CQURfUkVRVUVTVCAmJiBlcnIuc3RhdHVzIDwgSFRUUF9TVEFUVVMuSU5URVJOQUxfRVJST1IpIHtcbiAgICAgICAgICAgIC8vIFdpdGggbnBtIHJlZ2lzdGVyaW5nIGlzIHRoZSBzYW1lIGFzIGxvZ2dpbmcgaW4sXG4gICAgICAgICAgICAvLyBhbmQgbnBtIGFjY2VwdHMgb25seSBhbiA0MDkgZXJyb3IuXG4gICAgICAgICAgICAvLyBTbywgY2hhbmdpbmcgc3RhdHVzIGNvZGUgaGVyZS5cbiAgICAgICAgICAgIHJldHVybiBuZXh0KEVycm9yQ29kZS5nZXRDb2RlKGVyci5zdGF0dXMsIGVyci5tZXNzYWdlKSB8fCBFcnJvckNvZGUuZ2V0Q29uZmxpY3QoZXJyLm1lc3NhZ2UpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIG5leHQoZXJyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHRva2VuID0gbmFtZSAmJiBwYXNzd29yZCA/IGF3YWl0IGdldEFwaVRva2VuKGF1dGgsIGNvbmZpZywgdXNlciwgcGFzc3dvcmQpIDogdW5kZWZpbmVkO1xuXG4gICAgICAgIHJlcS5yZW1vdGVfdXNlciA9IHVzZXI7XG4gICAgICAgIHJlcy5zdGF0dXMoSFRUUF9TVEFUVVMuQ1JFQVRFRCk7XG4gICAgICAgIHJldHVybiBuZXh0KHtcbiAgICAgICAgICBvazogYHVzZXIgJyR7cmVxLmJvZHkubmFtZX0nIGNyZWF0ZWRgLFxuICAgICAgICAgIHRva2VuLFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgcm91dGUuZGVsZXRlKCcvLS91c2VyL3Rva2VuLyonLCBmdW5jdGlvbihyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6IFJlc3BvbnNlLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgcmVzLnN0YXR1cyhIVFRQX1NUQVRVUy5PSyk7XG4gICAgbmV4dCh7XG4gICAgICBvazogQVBJX01FU1NBR0UuTE9HR0VEX09VVCxcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gcGxhY2Vob2xkZXIgJ2NhdXNlIG5wbSByZXF1aXJlIHRvIGJlIGF1dGhlbnRpY2F0ZWQgdG8gcHVibGlzaFxuICAvLyB3ZSBkbyBub3QgZG8gYW55IHJlYWwgYXV0aGVudGljYXRpb24geWV0XG4gIHJvdXRlLnBvc3QoJy9fc2Vzc2lvbicsIENvb2tpZXMuZXhwcmVzcygpLCBmdW5jdGlvbihyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAgIHJlcy5jb29raWVzLnNldCgnQXV0aFNlc3Npb24nLCBTdHJpbmcoTWF0aC5yYW5kb20oKSksIGNyZWF0ZVNlc3Npb25Ub2tlbigpKTtcblxuICAgIG5leHQoe1xuICAgICAgb2s6IHRydWUsXG4gICAgICBuYW1lOiAnc29tZWJvZHknLFxuICAgICAgcm9sZXM6IFtdLFxuICAgIH0pO1xuICB9KTtcbn1cbiJdfQ==