#!/usr/bin/env node

/* eslint no-sync:0 */

/* eslint no-empty:0 */

/**
 * @prettier
 */
"use strict";

var _path = _interopRequireDefault(require("path"));

var _semver = _interopRequireDefault(require("semver"));

var _kleur = require("kleur");

var _bootstrap = require("./bootstrap");

var _configPath = _interopRequireDefault(require("./config-path"));

var _utils = require("./utils");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

require('pkginfo')(module);

if (process.getuid && process.getuid() === 0) {
  global.console.warn((0, _kleur.bgYellow)().red('*** WARNING: Verdaccio doesn\'t need superuser privileges. Don\'t run it under root! ***'));
}

const MIN_NODE_VERSION = '6.9.0';

if (_semver.default.satisfies(process.version, `>=${MIN_NODE_VERSION}`) === false) {
  global.console.error((0, _kleur.bgRed)(`Verdaccio requires at least Node.js ${MIN_NODE_VERSION} or higher, please upgrade your Node.js distribution`));
  process.exit(1);
}

process.title = 'verdaccio';

const logger = require('./logger');

logger.setup(null, {
  logStart: false
}); // default setup

const envinfo = require('envinfo');

const commander = require('commander');

const pkgVersion = module.exports.version;
const pkgName = module.exports.name;
commander.option('-i, --info', 'prints debugging information about the local environment').option('-l, --listen <[host:]port>', 'host:port number to listen on (default: localhost:4873)').option('-c, --config <config.yaml>', 'use this configuration file (default: ./config.yaml)').version(pkgVersion).parse(process.argv);

function init() {
  let verdaccioConfiguration;
  let configPathLocation;
  const cliListener = commander.listen;

  try {
    configPathLocation = (0, _configPath.default)(commander.config);
    verdaccioConfiguration = (0, _utils.parseConfigFile)(configPathLocation);
    process.title = verdaccioConfiguration.web && verdaccioConfiguration.web.title || 'verdaccio';

    if (!verdaccioConfiguration.self_path) {
      verdaccioConfiguration.self_path = _path.default.resolve(configPathLocation);
    }

    if (!verdaccioConfiguration.https) {
      verdaccioConfiguration.https = {
        enable: false
      };
    }

    logger.logger.warn({
      file: configPathLocation
    }, 'config file  - @{file}');
    (0, _bootstrap.startVerdaccio)(verdaccioConfiguration, cliListener, configPathLocation, pkgVersion, pkgName, _bootstrap.listenDefaultCallback);
  } catch (err) {
    logger.logger.fatal({
      file: configPathLocation,
      err: err
    }, 'cannot open config file @{file}: @{!err.message}');
    process.exit(1);
  }
}

if (commander.info) {
  // eslint-disable-next-line no-console
  console.log('\nEnvironment Info:');

  (async () => {
    const data = await envinfo.run({
      System: ['OS', 'CPU'],
      Binaries: ['Node', 'Yarn', 'npm'],
      Virtualization: ['Docker'],
      Browsers: ['Chrome', 'Edge', 'Firefox', 'Safari'],
      npmGlobalPackages: ['verdaccio']
    }); // eslint-disable-next-line no-console

    console.log(data);
    process.exit(0);
  })();
} else if (commander.args.length == 1 && !commander.config) {
  // handling "verdaccio [config]" case if "-c" is missing in command line
  commander.config = commander.args.pop();
  init();
} else if (commander.args.length !== 0) {
  commander.help();
} else {
  init();
}

process.on('uncaughtException', function (err) {
  logger.logger.fatal({
    err: err
  }, 'uncaught exception, please report this\n@{err.stack}');
  process.exit(255);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saWIvY2xpLnRzIl0sIm5hbWVzIjpbInJlcXVpcmUiLCJtb2R1bGUiLCJwcm9jZXNzIiwiZ2V0dWlkIiwiZ2xvYmFsIiwiY29uc29sZSIsIndhcm4iLCJyZWQiLCJNSU5fTk9ERV9WRVJTSU9OIiwic2VtdmVyIiwic2F0aXNmaWVzIiwidmVyc2lvbiIsImVycm9yIiwiZXhpdCIsInRpdGxlIiwibG9nZ2VyIiwic2V0dXAiLCJsb2dTdGFydCIsImVudmluZm8iLCJjb21tYW5kZXIiLCJwa2dWZXJzaW9uIiwiZXhwb3J0cyIsInBrZ05hbWUiLCJuYW1lIiwib3B0aW9uIiwicGFyc2UiLCJhcmd2IiwiaW5pdCIsInZlcmRhY2Npb0NvbmZpZ3VyYXRpb24iLCJjb25maWdQYXRoTG9jYXRpb24iLCJjbGlMaXN0ZW5lciIsImxpc3RlbiIsImNvbmZpZyIsIndlYiIsInNlbGZfcGF0aCIsInBhdGgiLCJyZXNvbHZlIiwiaHR0cHMiLCJlbmFibGUiLCJmaWxlIiwibGlzdGVuRGVmYXVsdENhbGxiYWNrIiwiZXJyIiwiZmF0YWwiLCJpbmZvIiwibG9nIiwiZGF0YSIsInJ1biIsIlN5c3RlbSIsIkJpbmFyaWVzIiwiVmlydHVhbGl6YXRpb24iLCJCcm93c2VycyIsIm5wbUdsb2JhbFBhY2thZ2VzIiwiYXJncyIsImxlbmd0aCIsInBvcCIsImhlbHAiLCJvbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7O0FBQ0E7O0FBQ0E7Ozs7O0FBSUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQUEsT0FBTyxDQUFDLFNBQUQsQ0FBUCxDQUFtQkMsTUFBbkI7O0FBRUEsSUFBSUMsT0FBTyxDQUFDQyxNQUFSLElBQWtCRCxPQUFPLENBQUNDLE1BQVIsT0FBcUIsQ0FBM0MsRUFBOEM7QUFDNUNDLEVBQUFBLE1BQU0sQ0FBQ0MsT0FBUCxDQUFlQyxJQUFmLENBQW9CLHVCQUFXQyxHQUFYLENBQWUsMEZBQWYsQ0FBcEI7QUFDRDs7QUFFRCxNQUFN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QyxFQUFBQSxPQUFPLENBQUNXLElBQVIsQ0FBYSxHQUFiO0FBQ0QsQ0FORCIsInNvdXJjZXNDb250ZW50IjpbIiMhL3Vzci9iaW4vZW52IG5vZGVcblxuLyogZXNsaW50IG5vLXN5bmM6MCAqL1xuLyogZXNsaW50IG5vLWVtcHR5OjAgKi9cbi8qKlxuICogQHByZXR0aWVyXG4gKi9cblxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgc2VtdmVyIGZyb20gJ3NlbXZlcic7XG5pbXBvcnQgeyBiZ1llbGxvdywgYmdSZWQgfSBmcm9tICdrbGV1cic7XG5pbXBvcnQge3N0YXJ0VmVyZGFjY2lvLCBsaXN0ZW5EZWZhdWx0Q2FsbGJhY2t9IGZyb20gJy4vYm9vdHN0cmFwJztcbmltcG9ydCBmaW5kQ29uZmlnRmlsZSBmcm9tICcuL2NvbmZpZy1wYXRoJztcbmltcG9ydCB7IHBhcnNlQ29uZmlnRmlsZSB9IGZyb20gJy4vdXRpbHMnO1xuXG5yZXF1aXJlKCdwa2dpbmZvJykobW9kdWxlKTtcblxuaWYgKHByb2Nlc3MuZ2V0dWlkICYmIHByb2Nlc3MuZ2V0dWlkKCkgPT09IDApIHtcbiAgZ2xvYmFsLmNvbnNvbGUud2FybihiZ1llbGxvdygpLnJlZCgnKioqIFdBUk5JTkc6IFZlcmRhY2NpbyBkb2VzblxcJ3QgbmVlZCBzdXBlcnVzZXIgcHJpdmlsZWdlcy4gRG9uXFwndCBydW4gaXQgdW5kZXIgcm9vdCEgKioqJykpO1xufVxuXG5jb25zdCBNSU5fTk9ERV9WRVJTSU9OID0gJzYuOS4wJztcblxuaWYgKHNlbXZlci5zYXRpc2ZpZXMocHJvY2Vzcy52ZXJzaW9uLCBgPj0ke01JTl9OT0RFX1ZFUlNJT059YCkgPT09IGZhbHNlKSB7XG4gIGdsb2JhbC5jb25zb2xlLmVycm9yKGJnUmVkKGBWZXJkYWNjaW8gcmVxdWlyZXMgYXQgbGVhc3QgTm9kZS5qcyAke01JTl9OT0RFX1ZFUlNJT059IG9yIGhpZ2hlciwgcGxlYXNlIHVwZ3JhZGUgeW91ciBOb2RlLmpzIGRpc3RyaWJ1dGlvbmApKTtcbiAgcHJvY2Vzcy5leGl0KDEpO1xufVxuXG5wcm9jZXNzLnRpdGxlID0gJ3ZlcmRhY2Npbyc7XG5cbmNvbnN0IGxvZ2dlciA9IHJlcXVpcmUoJy4vbG9nZ2VyJyk7XG5sb2dnZXIuc2V0dXAobnVsbCwge2xvZ1N0YXJ0OiBmYWxzZX0pOyAvLyBkZWZhdWx0IHNldHVwXG5cbmNvbnN0IGVudmluZm8gPSByZXF1aXJlKCdlbnZpbmZvJyk7XG5jb25zdCBjb21tYW5kZXIgPSByZXF1aXJlKCdjb21tYW5kZXInKTtcbmNvbnN0IHBrZ1ZlcnNpb24gPSBtb2R1bGUuZXhwb3J0cy52ZXJzaW9uO1xuY29uc3QgcGtnTmFtZSA9IG1vZHVsZS5leHBvcnRzLm5hbWU7XG5cbmNvbW1hbmRlclxuICAub3B0aW9uKCctaSwgLS1pbmZvJywgJ3ByaW50cyBkZWJ1Z2dpbmcgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGxvY2FsIGVudmlyb25tZW50JylcbiAgLm9wdGlvbignLWwsIC0tbGlzdGVuIDxbaG9zdDpdcG9ydD4nLCAnaG9zdDpwb3J0IG51bWJlciB0byBsaXN0ZW4gb24gKGRlZmF1bHQ6IGxvY2FsaG9zdDo0ODczKScpXG4gIC5vcHRpb24oJy1jLCAtLWNvbmZpZyA8Y29uZmlnLnlhbWw+JywgJ3VzZSB0aGlzIGNvbmZpZ3VyYXRpb24gZmlsZSAoZGVmYXVsdDogLi9jb25maWcueWFtbCknKVxuICAudmVyc2lvbihwa2dWZXJzaW9uKVxuICAucGFyc2UocHJvY2Vzcy5hcmd2KTtcblxuZnVuY3Rpb24gaW5pdCgpIHtcbiAgbGV0IHZlcmRhY2Npb0NvbmZpZ3VyYXRpb247XG4gIGxldCBjb25maWdQYXRoTG9jYXRpb247XG4gIGNvbnN0IGNsaUxpc3RlbmVyID0gY29tbWFuZGVyLmxpc3RlbjtcblxuICB0cnkge1xuICAgIGNvbmZpZ1BhdGhMb2NhdGlvbiA9IGZpbmRDb25maWdGaWxlKGNvbW1hbmRlci5jb25maWcpO1xuICAgIHZlcmRhY2Npb0NvbmZpZ3VyYXRpb24gPSBwYXJzZUNvbmZpZ0ZpbGUoY29uZmlnUGF0aExvY2F0aW9uKTtcbiAgICBwcm9jZXNzLnRpdGxlID0gdmVyZGFjY2lvQ29uZmlndXJhdGlvbi53ZWIgJiYgdmVyZGFjY2lvQ29uZmlndXJhdGlvbi53ZWIudGl0bGUgfHwgJ3ZlcmRhY2Npbyc7XG5cbiAgICBpZiAoIXZlcmRhY2Npb0NvbmZpZ3VyYXRpb24uc2VsZl9wYXRoKSB7XG4gICAgICB2ZXJkYWNjaW9Db25maWd1cmF0aW9uLnNlbGZfcGF0aCA9IHBhdGgucmVzb2x2ZShjb25maWdQYXRoTG9jYXRpb24pO1xuICAgIH1cbiAgICBpZiAoIXZlcmRhY2Npb0NvbmZpZ3VyYXRpb24uaHR0cHMpIHtcbiAgICAgIHZlcmRhY2Npb0NvbmZpZ3VyYXRpb24uaHR0cHMgPSB7ZW5hYmxlOiBmYWxzZX07XG4gICAgfVxuXG4gICAgbG9nZ2VyLmxvZ2dlci53YXJuKHtmaWxlOiBjb25maWdQYXRoTG9jYXRpb259LCAnY29uZmlnIGZpbGUgIC0gQHtmaWxlfScpO1xuXG4gICAgc3RhcnRWZXJkYWNjaW8odmVyZGFjY2lvQ29uZmlndXJhdGlvbiwgY2xpTGlzdGVuZXIsIGNvbmZpZ1BhdGhMb2NhdGlvbiwgcGtnVmVyc2lvbiwgcGtnTmFtZSwgbGlzdGVuRGVmYXVsdENhbGxiYWNrKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nZ2VyLmxvZ2dlci5mYXRhbCh7ZmlsZTogY29uZmlnUGF0aExvY2F0aW9uLCBlcnI6IGVycn0sICdjYW5ub3Qgb3BlbiBjb25maWcgZmlsZSBAe2ZpbGV9OiBAeyFlcnIubWVzc2FnZX0nKTtcbiAgICBwcm9jZXNzLmV4aXQoMSk7XG4gIH1cbn1cblxuaWYgKGNvbW1hbmRlci5pbmZvKSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG5cdGNvbnNvbGUubG9nKCdcXG5FbnZpcm9ubWVudCBJbmZvOicpO1xuICAoYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCBlbnZpbmZvLnJ1bih7XG4gICAgICAgIFN5c3RlbTogWydPUycsICdDUFUnXSxcbiAgICAgICAgQmluYXJpZXM6IFsnTm9kZScsICdZYXJuJywgJ25wbSddLFxuICAgICAgICBWaXJ0dWFsaXphdGlvbjogWydEb2NrZXInXSxcbiAgICAgICAgQnJvd3NlcnM6IFsnQ2hyb21lJywgJ0VkZ2UnLCAnRmlyZWZveCcsICdTYWZhcmknXSxcbiAgICAgICAgbnBtR2xvYmFsUGFja2FnZXM6IFsndmVyZGFjY2lvJ10sXG4gICAgICB9KTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZVxuICAgIGNvbnNvbGUubG9nKGRhdGEpO1xuICAgIHByb2Nlc3MuZXhpdCgwKTtcbiAgfSkoKTtcbn0gZWxzZSAgaWYgKGNvbW1hbmRlci5hcmdzLmxlbmd0aCA9PSAxICYmICFjb21tYW5kZXIuY29uZmlnKSB7XG4gIC8vIGhhbmRsaW5nIFwidmVyZGFjY2lvIFtjb25maWddXCIgY2FzZSBpZiBcIi1jXCIgaXMgbWlzc2luZyBpbiBjb21tYW5kIGxpbmVcbiAgY29tbWFuZGVyLmNvbmZpZyA9IGNvbW1hbmRlci5hcmdzLnBvcCgpO1xuICBpbml0KCk7XG59IGVsc2UgaWYgKGNvbW1hbmRlci5hcmdzLmxlbmd0aCAhPT0gMCkge1xuICBjb21tYW5kZXIuaGVscCgpO1xufSBlbHNlIHtcbiAgaW5pdCgpO1xufVxuXG5wcm9jZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIGZ1bmN0aW9uKGVycikge1xuICBsb2dnZXIubG9nZ2VyLmZhdGFsKCB7XG4gICAgZXJyOiBlcnIsXG4gIH0sXG4gICd1bmNhdWdodCBleGNlcHRpb24sIHBsZWFzZSByZXBvcnQgdGhpc1xcbkB7ZXJyLnN0YWNrfScgKTtcbiAgcHJvY2Vzcy5leGl0KDI1NSk7XG59KTtcbiJdfQ==