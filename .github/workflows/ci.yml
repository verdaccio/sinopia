name: CI

on: [push, pull_request]

permissions:
  contents: read
concurrency:
  group: ci-${{ github.ref }}
  cancel-in-progress: true  

jobs:
  ci:
    name: Node ${{ matrix.node_version }}

    strategy:
      fail-fast: false
      matrix:
        # only suported versions defined at https://nodejs.org/en/about/previous-releases
        node_version: [18, 20, 21] # 22 excluded for now, fails on yarn install

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@f43a0e5ff2bd294095638e18286ca9a3d1956744 # v3.6.0
    - name: Use Node ${{ matrix.node_version }}
      uses: actions/setup-node@7c12f8017d5436eb855f1ed4399f037a36fbd9e8 # v2.5.2
      with:
        node-version: ${{ matrix.node_version }}
    - name: Install
      run: yarn install --immutable
    - name: Build
      run: yarn build
    - name: Types
      run: yarn code:types            
    - name: Test
      run: yarn test
